import axios from "axios";
import { _ODK_FILE_LIST_FILENAME } from "../consts";

import { AnalysisPackage, FolderType, CheckFileResponse, AnalysisSummary, DataFile, NewAnalysis, User, Topic, } from "../types";
import { _HOST } from "../urls";

// NEED PROPER ERROR HANDLING ON ALL OF THIS. Including try/catch

export async function getAllAnalyses(): Promise<AnalysisSummary[] | undefined> {
    try {
        const res = await axios.get<AnalysisSummary[]>(`${_HOST}/analyses`);
        return res.data;
    }
    catch {
        return undefined;
    }
};

export async function getAllDataFiles(): Promise<DataFile[] | undefined> {
    try {
        const res = await axios.get<DataFile[]>(`${_HOST}/datafiles`);
        return res.data;
    }
    catch {
        return undefined;
    }
};

export async function getODKListFiles(): Promise<string[] | undefined> {
    try {
        const res = await axios.get(`${_HOST}/pvf/data/x/${_ODK_FILE_LIST_FILENAME}`);
        return res.data;
    }
    catch {
        return undefined;
    }
};

///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////


export async function getTopics(): Promise<Topic[] | undefined> {
    try {
        const res = await axios.get<Topic[]>(`${_HOST}/topics`);
        return res.data;
    }
    catch {
        return undefined;
    }
};

export async function updateTopics(newTopics: Topic[]): Promise<string | undefined> {
    try {
        const res = await axios.post(`${_HOST}/updatetopics`, newTopics);
        return "success";
    }
    catch {
        return undefined;
    }
};

///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////

export async function deleteDataFile(fileName: string): Promise<DataFile[] | undefined> {
    try {
        const res = await axios.get(`${_HOST}/deletedatafile/${fileName}`);
        return res.data;
    }
    catch {
        return undefined;
    }
};

///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////

export async function getAnalysis(analysisId: string): Promise<AnalysisPackage | undefined> {
    try {
        const res = await axios.get(`${_HOST}/analysis/${analysisId}`);
        return res.data;
    }
    catch {
        return undefined;
    }
};

export async function createAnalysis(na: NewAnalysis): Promise<AnalysisSummary[] | undefined> {
    try {
        const res = await axios.post(`${_HOST}/createanalysis`, na);
        return res.data;
    }
    catch {
        return undefined;
    }
};

export async function deleteAnalysis(analysisId: string): Promise<AnalysisSummary[] | undefined> {
    try {
        const res = await axios.get(`${_HOST}/deleteanalysis/${analysisId}`);
        return res.data;
    }
    catch {
        return undefined;
    }
};

export async function updateAnalysis(newAnalysis: AnalysisPackage): Promise<AnalysisPackage | undefined> {
    try {
        const res = await axios.post(`${_HOST}/updateanalysis`, newAnalysis);
        return res.data;
    }
    catch {
        return undefined;
    }
};

///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////

export async function checkFile(folderType: FolderType, analysisId: string, fileName: string): Promise<CheckFileResponse | undefined> {
    try {
        const res = await axios.get(`${_HOST}/cf/${folderType}/${analysisId}/${fileName}`);
        return res.data;
    }
    catch {
        return undefined;
    }
};

///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////

export async function getAllUsers(): Promise<User[] | undefined> {
    try {
        const res = await axios.get(`${_HOST}/all_users`);
        return res.data;
    }
    catch {
        return undefined;
    }
};