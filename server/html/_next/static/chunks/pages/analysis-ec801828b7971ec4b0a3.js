(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[261],{6585:function(e,t,n){"use strict";n.d(t,{P:function(){return p},K:function(){return f}});var a=n(5893),r=n(7294),i=n(938),s=n(9248),u=n(809),l=n.n(u),c=n(2447),o=n(6131);function d(e,t,n,a){var i=(0,r.useState)(void 0),s=i[0],u=i[1];function d(){return(d=(0,c.Z)(l().mark((function e(t,n,a){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u(void 0),e.next=3,(0,o.Oo)(t,n,a);case 3:if(r=e.sent){e.next=8;break}return console.error("Could not check file"),u({exists:!1,date:"",size:0,public:!1}),e.abrupt("return");case 8:u(r);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return(0,r.useEffect)((function(){a||function(e,t,n){d.apply(this,arguments)}(e,t,n||"noname")}),[e,t,n,a]),s}var f=function(e){var t=d(e.folderType,e.analysisId,e.fileName,e.needsSaving),n=(0,r.useState)(!1),u=n[0],l=n[1],c=(0,r.useRef)(null);var o=t&&t.exists?t.public?"".concat(s.i,"/exf/").concat(e.analysisId,"/").concat(e.fileName):"".concat(s.i,"/pvf/").concat(e.folderType,"/").concat(e.analysisId,"/").concat(e.fileName):"";return e.needsSaving?(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Save to confirm status"}):t?t.exists?t.public?(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("a",{ref:c,className:"break-all ui-link",href:o,download:!0,target:"_blank",children:"https://portal.comsa.org.mz"+o}),(0,a.jsxs)("div",{className:"mt-1",children:[(0,a.jsx)("span",{className:"px-2 py-1 text-xs ui-btn-lightgray",onClick:function(){c.current&&((0,i.Ms)(c.current),l(!0),setTimeout((function(){l(!1)}),1e3))},children:u?"Copied!":"Copy link"}),(0,a.jsxs)("span",{className:"ml-2",children:["Last modified: ",new Date(t.date).toLocaleString()]}),(0,a.jsxs)("span",{className:"ml-2",children:["Size: ",(0,i.gB)(t.size)]})]})]}):(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("a",{ref:c,className:"ui-link",href:o,download:!0,target:"_blank",children:"Download"}),(0,a.jsxs)("span",{className:"ml-2",children:["Last modified: ",new Date(t.date).toLocaleString()]}),(0,a.jsxs)("span",{className:"ml-2",children:["Size: ",(0,i.gB)(t.size)]})]}):(0,a.jsx)("div",{className:"text-sm text-red-500",children:"Does not exist"}):(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Checking file..."})},p=function(e){var t=e.url,n=e.linkLabel;return(0,a.jsx)("a",{className:"ui-link",href:t,download:!0,target:"_blank",children:n})}},8212:function(e,t,n){"use strict";n.d(t,{u_:function(){return i},nK:function(){return s}});var a=n(5893),r=n(7294),i=function(e){var t=(0,r.useRef)(void 0),n=(0,r.useRef)(void 0);return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 overflow-auto text-svggray",style:{background:"rgba(0,0,0,0.6)"},onMouseDown:function(e){return t.current=e.target},onMouseUp:function(e){return n.current=e.target},onClick:function(a){t.current===n.current&&n.current===a.target&&e.cancel()},children:(0,a.jsx)("div",{className:"relative px-6 py-6 bg-white ui-form-rounded",style:{maxWidth:e.minWidth?void 0:600,width:e.minWidth},onClick:function(e){return e.stopPropagation()},children:e.children})})},s=function(e){return(0,a.jsx)("div",{className:"flex mt-4",children:e.children})}},2688:function(e,t,n){"use strict";n.d(t,{c:function(){return f}});var a=n(809),r=n.n(a),i=n(5893),s=n(1385),u=n(2447),l=n(7294),c=n(8813),o=n(8212),d=n(3384),f=function(e){var t=(0,l.useState)(e.initialName),n=t[0],a=t[1],f=(0,l.useState)(e.initialLanguage),p=f[0],m=f[1],x=(0,l.useState)(e.initialTopic),g=x[0],h=x[1],y=(0,l.useState)(e.initialTags.join(", ")),v=y[0],b=y[1],j=(0,l.useState)(e.initialScheduled),S=j[0],N=j[1],w=(0,l.useState)(!1),C=w[0],k=w[1];function O(){return L.apply(this,arguments)}function L(){return(L=(0,u.Z)(r().mark((function t(){var a;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(""!==n.trim()){t.next=3;break}return window.alert("You must enter a name for the analysis"),t.abrupt("return");case 3:return k(!0),a=v.trim().split(",").map((function(e){return e.trim()})).filter((function(e){return e})),t.next=7,e.save(n.trim(),p,g.trim(),a,S);case 7:e.cancel();case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function T(){return(T=(0,u.Z)(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.attemptDeleteAnalysis){t.next=2;break}return t.abrupt("return");case 2:return k(!0),t.next=5,e.attemptDeleteAnalysis();case 5:e.cancel();case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return(0,i.jsx)(o.u_,{cancel:e.cancel,minWidth:600,children:C?(0,i.jsx)("div",{className:"",children:"Saving..."}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"ui-form-subheader",children:"Title"}),(0,i.jsx)(d.u3,{value:n,onChange:a,autoFocus:!0}),(0,i.jsx)("div",{className:"mt-4 ui-form-subheader",children:"Statistical package"}),(0,i.jsx)(d.Cj,{value:p,onChange:function(e){return m(e)},options:[{value:c.$v.Stata,text:"Stata"},{value:c.$v.R,text:"R"}]}),(0,i.jsx)("div",{className:"mt-4 ui-form-subheader",children:"Topic"}),(0,i.jsx)(d.Cj,{value:g,onChange:function(e){return h(String(e))},options:[{value:"",text:"No topic"}].concat((0,s.Z)(e.topics.map((function(e){return{value:e.id,text:e.label}}))))}),(0,i.jsx)("div",{className:"mt-4 ui-form-subheader",children:"Tags (comma separated)"}),(0,i.jsx)(d.u3,{value:v,onChange:b}),(0,i.jsx)("div",{className:"mt-4 ui-form-subheader",children:"Scheduler"}),(0,i.jsx)(d.mA,{rootId:"schedule",label:"Include this analysis in daily scheduled run",checked:S,onChange:function(e){return N(e)}}),e.isNewAnalysis?(0,i.jsxs)(o.nK,{children:[(0,i.jsx)(d.y3,{label:"Create new analysis",onClick:O,color:d.Wo.Green}),(0,i.jsx)(d.y3,{label:"Cancel",onClick:e.cancel,color:d.Wo.Gray,marginLeft:!0})]}):(0,i.jsxs)(o.nK,{children:[(0,i.jsx)(d.y3,{label:"Done",onClick:O,color:d.Wo.Blue}),(0,i.jsx)(d.y3,{label:"Cancel",onClick:e.cancel,color:d.Wo.Gray,marginLeft:!0}),(0,i.jsx)("div",{className:"flex-1"}),(0,i.jsx)(d.y3,{label:"Delete this analysis",onClick:function(){return T.apply(this,arguments)},color:d.Wo.Red,marginLeft:!0})]})]})})}},3384:function(e,t,n){"use strict";n.d(t,{Wo:function(){return a},qY:function(){return i},y3:function(){return o},_3:function(){return m},Cj:function(){return x},o3:function(){return p},u3:function(){return g},mA:function(){return h},$j:function(){return y}});var a,r,i,s=n(5893);function u(e){switch(e){case a.Blue:return"ui-btn-blue";case a.Green:return"ui-btn-green";case a.Red:return"ui-btn-red";case a.Orange:return"ui-btn-orange";case a.Gray:return"ui-btn-gray";case a.Purple:return"ui-btn-purple";case a.LightGray:return"ui-btn-lightgray";default:return u(a.LightGray)}}function l(e){switch(e){case r.Small:return"ui-btn-small";case r.Medium:return"ui-btn-medium";case r.Large:return"ui-btn-large";default:return l(r.Medium)}}function c(e){switch(e){case r.Small:return"-ml-0.5 mr-2 h-4 w-4";case r.Medium:return"-ml-1 mr-2 h-5 w-5";case r.Large:return"-ml-1 mr-3 h-5 w-5";default:return c(r.Medium)}}!function(e){e[e.Blue=0]="Blue",e[e.Green=1]="Green",e[e.Gray=2]="Gray",e[e.Red=3]="Red",e[e.Orange=4]="Orange",e[e.LightGray=5]="LightGray",e[e.Purple=6]="Purple"}(a||(a={})),function(e){e.Small="small",e.Medium="medium",e.Large="large"}(r||(r={})),function(e){e.Submit="submit"}(i||(i={}));var o=function(e){var t="".concat(e.disabled?"pointer-events-none":""," ").concat(l(e.size)," ").concat(u(e.color)," ").concat(e.marginLeft?"ui-margin-left":"ml-0"," ").concat(e.marginRight?"ui-margin-right":"mr-0").replace(/\s+/g," ").trim();return(0,s.jsx)("button",{className:t,type:e.type||"button",form:e.form,onClick:e.onClick,disabled:e.disabled,children:e.icon?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.icon,{className:c(e.size)})," ",e.label]}):e.label})};function d(e){switch(e){case r.Small:return"ui-iconbtn-small";case r.Medium:return"ui-iconbtn-medium";case r.Large:return"ui-iconbtn-large";default:return d(r.Medium)}}function f(e){switch(e){case r.Small:return"1rem";case r.Medium:return"1.25rem";case r.Large:return"1.5rem";default:return f(r.Medium)}}var p,m=function(e){var t="".concat(d(e.size)," ").concat(u(e.color)," ").concat(e.marginLeft?"ui-margin-left":"ml-0"," ").concat(e.marginRight?"ui-margin-right":"mr-0").replace(/\s+/g," ").trim();return(0,s.jsx)("button",{className:t,type:"button",onClick:e.onClick,children:(0,s.jsx)(e.icon,{className:"",style:{height:f(e.size),width:f(e.size)}})})},x=function(e){var t="".concat(e.purple?"ui-select-purple":"ui-select"," ").concat(e.marginLeft?"ui-margin-left":"ml-0"," ").concat(e.marginRight?"ui-margin-right":"mr-0");return(0,s.jsx)("select",{className:t,value:e.value,onChange:function(t){return e.onChange(t.target.value)},disabled:e.disabled,children:e.options.map((function(e){return(0,s.jsx)("option",{value:e.value,children:e.text},e.value)}))})};!function(e){e.text="text",e.email="email",e.password="password",e.number="number"}(p||(p={}));var g=function(e){var t="".concat(e.purple?"ui-input-purple":"ui-input"," ").concat(e.marginLeft?"ui-margin-left":"ml-0"," ").concat(e.marginRight?"ui-margin-right":"mr-0");return(0,s.jsx)("input",{className:t,type:e.type||p.text,value:e.value,onChange:function(t){return e.onChange(t.target.value)},autoFocus:e.autoFocus,disabled:e.disabled})},h=function(e){var t="".concat(e.inline?"inline-flex mr-6":"flex"," items-center align-bottom justify-start");return(0,s.jsxs)("div",{className:t,children:[(0,s.jsx)("input",{id:e.rootId,type:e.radio?"radio":"checkbox",className:e.radio?"ui-radio-icon":"ui-checkbox-icon",checked:e.checked,onChange:function(t){return e.onChange(t.target.checked)}}),(0,s.jsx)("label",{htmlFor:e.rootId,className:"ui-checkbox-label",children:e.label})]})},y=function(e){return(0,s.jsxs)("svg",{className:"inline-block ".concat(v(e.size)," animate-spin text-green-600"),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})};function v(e){switch(e){case void 0:return"w-12 h-12";case 6:return"w-6 h-6";case 8:return"w-8 h-8";case 10:return"w-10 h-10";case 12:return"w-12 h-12";case 16:return"w-16 h-16";case 24:return"w-24 h-24";default:return"w-6 h-6"}}},1737:function(e,t,n){"use strict";n.d(t,{i:function(){return u}});var a=n(5893),r=n(7294),i=n(8080),s=n(1163),u=function(e){var t=e.children,n=e.uu;return(0,r.useEffect)((function(){n.loginState===i.z.LoggedOut&&s.default.push("/login")}),[n.loginState]),n.loginState===i.z.LoggingOut||n.loginState===i.z.LoggedOut?(0,a.jsx)("div",{className:"px-8 py-6",children:"Logging out..."}):n.loginState===i.z.LoggingIn?(0,a.jsx)("div",{className:"px-8 py-6",children:"Logging in..."}):(0,a.jsx)(a.Fragment,{children:t})}},6929:function(e,t,n){"use strict";n.d(t,{H:function(){return r}});var a=n(7294);function r(){var e=(0,a.useState)(null),t=e[0],n=e[1],r=(0,a.useState)(null),i=r[0],s=r[1],u=(0,a.useCallback)((function(e){null!==e&&(n(e.getBoundingClientRect()),s(e))}),[]);return(0,a.useEffect)((function(){function e(){null!==i&&n(i.getBoundingClientRect())}return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[i]),{rect:t,ref:u}}},894:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return B}});var a=n(809),r=n.n(a),i=n(5893),s=n(6265),u=n(2447),l=n(9008),c=n(9248),o=n(8080),d=n(1163),f=n(7294),p=n(6131),m=n(8813),x=n(938);function g(e){var t=(0,d.useRouter)();(0,f.useEffect)((function(){t.isReady&&(t.query.id&&t.query.id?t.query.id instanceof Array?d.default.push("/"):function(e){_.apply(this,arguments)}(t.query.id):d.default.push("/"))}),[t.isReady,t.query.id]);var n=(0,f.useState)({loading:!0,ready:!1}),a=n[0],i=n[1],s=(0,f.useState)("Loading..."),l=s[0],c=s[1],o=(0,f.useState)(m.$v.R),g=o[0],h=o[1],y=(0,f.useState)(""),v=y[0],b=y[1],j=(0,f.useState)([]),S=j[0],N=j[1],w=(0,f.useState)(""),C=w[0],k=w[1],O=(0,f.useState)(!1),L=O[0],T=O[1],R=(0,f.useState)([]),A=R[0],E=R[1],I=(0,f.useState)([]),z=I[0],P=I[1],F=(0,f.useState)(!1),D=F[0],G=F[1];function q(e){e?(i({loading:!1,ready:!0,analysisPackage:e}),M(e)):i({loading:!1,ready:!1,err:"Could not reach server"})}function _(){return(_=(0,u.Z)(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.ny)(t);case 2:q(e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){c(e.metadata.name),h(e.metadata.language),N(e.metadata.tags),k(e.metadata.topic),T(e.metadata.scheduled),b(e.code),E(e.metadata.inputs),P(e.metadata.outputs),G(!1)}function U(){return(U=(0,u.Z)(r().mark((function t(){var n,s;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.ready){t.next=2;break}return t.abrupt("return");case 2:return i({loading:!0,ready:!1}),n={id:a.analysisPackage.id,code:v,metadata:{name:l,language:g,inputs:A,outputs:z,topic:C,tags:S,createdAt:a.analysisPackage.metadata.createdAt,createdBy:a.analysisPackage.metadata.createdBy,lastRunAt:a.analysisPackage.metadata.lastRunAt,lastRunBy:a.analysisPackage.metadata.lastRunBy,lastModifiedAt:a.analysisPackage.metadata.lastModifiedAt,lastModifiedBy:a.analysisPackage.metadata.lastModifiedBy,scheduled:L,lastStatus:a.analysisPackage.metadata.lastStatus}},t.next=6,(0,p.cw)(n);case 6:if(s=t.sent){t.next=10;break}return alert("Could not save"),t.abrupt("return");case 10:return t.next=12,e();case 12:q(s);case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function B(){return(B=(0,u.Z)(r().mark((function n(){return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a.ready){n.next=2;break}return n.abrupt("return");case 2:if(window.confirm("Are you sure?")){n.next=4;break}return n.abrupt("return");case 4:return i({loading:!0,ready:!1}),n.next=7,(0,p.qn)(a.analysisPackage.id);case 7:if(n.sent){n.next=11;break}return alert("Could not delete"),n.abrupt("return");case 11:return n.next=13,e();case 13:t.push("/");case 14:case"end":return n.stop()}}),n)})))).apply(this,arguments)}return{data:a,tempName:l,tempLanguage:g,tempCode:v,tempTopic:C,tempTags:S,tempInputs:A,tempScheduled:L,tempOutputs:z,updateTempName:function(e){G(!0),c(e)},updateTempLanguage:function(e){G(!0),h(e)},updateTempCode:function(e){G(!0),b(e)},updateTempTopic:function(e){G(!0),k(e)},updateTempTags:function(e){G(!0),N(e)},updateTempScheduled:function(e){G(!0),T(e)},updateTempInputFolder:function(e,t){G(!0),E((function(n){var a=(0,x.JG)(n);return a[t].folderType="data"===e?m.Sr.DATA:m.Sr.ANALYSIS,a[t].analysisId=e,a[t].fileName="UNSELECTED",a}))},updateTempInputFile:function(e,t){G(!0),E((function(n){var a=(0,x.JG)(n);return a[t].fileName=e,a}))},addTempInputFile:function(){G(!0),E((function(e){var t=(0,x.JG)(e);return t.push({analysisId:"data",folderType:m.Sr.DATA,fileName:"UNSELECTED"}),t}))},removeTempInputFile:function(e){window.confirm("Are you sure?")&&(G(!0),E((function(t){var n=(0,x.JG)(t);return n.splice(e,1),n})))},updateTempOutputName:function(e,t){G(!0),P((function(n){var a=(0,x.JG)(n);return a[t].fileName=e,a}))},updateTempOutputPublic:function(e,t){G(!0),P((function(n){var a=(0,x.JG)(n);return a[t].public=e,a}))},addTempOutputFile:function(){G(!0),P((function(e){var t=(0,x.JG)(e);return t.push({fileName:"",public:!1}),t}))},removeTempOutputFile:function(e){window.confirm("Are you sure?")&&(G(!0),P((function(t){var n=(0,x.JG)(t);return n.splice(e,1),n})))},needsSaving:D,save:function(){return U.apply(this,arguments)},revert:function(){window.confirm("Are you sure?")&&a.ready&&M(a.analysisPackage)},attemptDeleteAnalysis:function(){return B.apply(this,arguments)}}}var h=n(1737),y=n(2688),v=n(5152),b=n(6049),j=n(3384),S=function(e){return(0,i.jsxs)("div",{className:"flex",children:[(0,i.jsxs)("div",{className:"flex-1 ui-pad",children:[e.analysisStatus.analyzing?(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(j.$j,{size:8}),(0,i.jsx)(j.y3,{label:"Stop",onClick:e.stop,color:j.Wo.Red,icon:b.b0D,marginLeft:!0})]}):e.uap.needsSaving?(0,i.jsx)(j.y3,{label:"Save before running",icon:b.SCS,disabled:!0}):(0,i.jsx)(j.y3,{label:"Run analysis",onClick:e.analyze,color:j.Wo.Green,icon:b.YGl}),(0,i.jsxs)("div",{className:"mt-2",children:["Status: ",w(e.analysisStatus.finalStatus)]})]}),(0,i.jsxs)("div",{className:"flex-none text-sm ui-pad",children:[(0,i.jsxs)("div",{className:"flex",children:[(0,i.jsx)("div",{className:"flex-1 text-right",children:"Initialized analysis"}),(0,i.jsx)("div",{className:"flex-none ml-2",children:N(e.analysisStatus[m.Hf.InitializeAnalysis])})]}),(0,i.jsxs)("div",{className:"flex",children:[(0,i.jsx)("div",{className:"flex-1 text-right",children:"Found all input files"}),(0,i.jsx)("div",{className:"flex-none ml-2",children:N(e.analysisStatus[m.Hf.ImportInputFiles])})]}),(0,i.jsxs)("div",{className:"flex",children:[(0,i.jsx)("div",{className:"flex-1 text-right",children:"Finished script"}),(0,i.jsx)("div",{className:"flex-none ml-2",children:N(e.analysisStatus[m.Hf.CleanRun])})]}),(0,i.jsxs)("div",{className:"flex",children:[(0,i.jsx)("div",{className:"flex-1 text-right",children:"Created all output files"}),(0,i.jsx)("div",{className:"flex-none ml-2",children:N(e.analysisStatus[m.Hf.OutputFiles])})]})]})]})};function N(e){switch(e){case m.Aq.Pending:return(0,i.jsx)("svg",{className:"flex-shrink-0 w-5 h-5 text-orange-500",viewBox:"0 0 20 20",fill:"currentColor",children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16z",clipRule:"evenodd"})});case m.Aq.Success:return(0,i.jsx)("svg",{className:"flex-shrink-0 w-5 h-5 text-green-500",viewBox:"0 0 20 20",fill:"currentColor",children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})});case m.Aq.Failure:return(0,i.jsx)("svg",{className:"flex-shrink-0 w-5 h-5 text-red-500",viewBox:"0 0 20 20",fill:"currentColor",children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}return(0,i.jsx)("svg",{className:"flex-shrink-0 w-5 h-5 text-gray-300",viewBox:"0 0 20 20",fill:"currentColor",children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16z",clipRule:"evenodd"})})}function w(e){switch(e){case m.qb.NotRun:return"Not Run";case m.qb.Success:return"Success";case m.qb.Failed:return"Failed";case m.qb.Running:return"Running";case m.qb.StoppedByUser:return"Stopped by user";default:return"Unknown"}}var C=n(1385),k=n(6585),O=function(e){return(0,i.jsxs)("div",{className:"w-full h-full overflow-y-auto ui-pad",children:[e.uap.tempInputs.map((function(t,n){var a=function(e,t,n,a){if(e===m.Sr.DATA)return n.map((function(e){return{value:e.fileName,text:e.fileName}}));var r=a.find((function(e){return e.id===t}));if(!r)return[];return r.metadata.outputs.map((function(e){return{value:e.fileName,text:e.fileName}}))}(t.folderType,t.analysisId,e.ud.dataFiles,e.ua.analyses);return(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsxs)("div",{className:"flex mb-1",children:[(0,i.jsx)("div",{className:"flex-1",children:(0,i.jsx)(j.Cj,{value:t.analysisId,onChange:function(t){return e.uap.updateTempInputFolder(String(t),n)},options:[{value:"data",text:"Data"}].concat((0,C.Z)(e.ua.analyses.filter((function(t){return t.id!==e.analysisId})).map((function(e){return{value:e.id,text:e.metadata.name}})))),disabled:!e.canEdit})}),(0,i.jsx)("div",{className:"flex-1 ml-3",children:(0,i.jsx)(j.Cj,{value:t.fileName,onChange:function(t){return e.uap.updateTempInputFile(String(t),n)},options:[{value:"UNSELECTED",text:"Unselected"}].concat((0,C.Z)(a)),disabled:!e.canEdit})}),e.canEdit&&(0,i.jsx)("span",{className:"flex-none ml-3",children:(0,i.jsx)(j._3,{icon:b.XHJ,onClick:function(){return e.uap.removeTempInputFile(n)}})})]}),(0,i.jsx)(k.K,{folderType:t.folderType,analysisId:t.analysisId,fileName:t.fileName,needsSaving:!1})]},n)})),e.canEdit&&(0,i.jsx)(j._3,{icon:b.pOD,onClick:e.uap.addTempInputFile}),(0,i.jsx)("div",{className:"py-2"})]})};var L=function(e){return(0,i.jsx)("div",{className:"w-full h-full overflow-y-auto ui-pad",children:e.isAnalyzing?(0,i.jsx)("div",{className:"",children:"Currently analyzing..."}):(0,i.jsxs)(i.Fragment,{children:[e.uap.tempOutputs.map((function(t,n){return e.uap.data.ready?(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsxs)("div",{className:"flex mb-1",children:[(0,i.jsx)("div",{className:"flex-1",children:(0,i.jsx)(j.u3,{value:t.fileName,onChange:function(t){return e.uap.updateTempOutputName(t,n)},disabled:!e.canEdit})}),e.canEdit&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("span",{className:"flex-none ml-3",children:[(0,i.jsx)(j.y3,{label:"Private",onClick:function(){return e.uap.updateTempOutputPublic(!1,n)},color:t.public?j.Wo.LightGray:j.Wo.Gray,disabled:!t.public}),(0,i.jsx)(j.y3,{label:"Public",onClick:function(){return e.uap.updateTempOutputPublic(!0,n)},color:t.public?j.Wo.Gray:j.Wo.LightGray,disabled:t.public})]}),(0,i.jsx)("span",{className:"flex-none ml-3",children:(0,i.jsx)(j._3,{icon:b.XHJ,onClick:function(){return e.uap.removeTempOutputFile(n)}})})]})]}),(0,i.jsx)(k.K,{folderType:m.Sr.ANALYSIS,analysisId:e.uap.data.analysisPackage.id,fileName:t.fileName,needsSaving:e.uap.needsSaving})]},n):null})),e.canEdit&&(0,i.jsx)(j._3,{icon:b.pOD,onClick:e.uap.addTempOutputFile}),(0,i.jsx)("div",{className:"py-2"})]})})},T=function(e){return(0,i.jsxs)("header",{className:"flex items-center w-full h-10 text-white bg-gray-800 select-none font-book",children:[(0,i.jsx)("button",{className:"flex-none h-full px-4 py-2 w-14 ui-btn-blue",onClick:function(){e.uap.needsSaving&&!window.confirm("You have unsaved changes which will be lost if you continue. Are you sure you want to continue?")||d.default.push("/")},children:(0,i.jsx)(b.Y4O,{})}),(0,i.jsx)("h2",{className:"flex-1 px-4 text-base font-semibold leading-none tracking-wide truncate",children:e.uap.tempName}),!e.uap.data.loading&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"flex-none px-4 text-sm leading-none text-blue-300 border-none",children:e.uap.tempLanguage===m.$v.R?"R":"Stata"}),e.canEdit&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{className:"flex-none h-full px-4 border-none text-sm leading-none ".concat(e.uap.needsSaving?"ui-btn-green":"bg-gray-800 text-gray-500 pointer-events-none"," "),onClick:e.uap.save,disabled:!e.uap.needsSaving,children:"Save"}),(0,i.jsx)("button",{className:"flex-none h-full px-4 border-none text-sm leading-none ".concat(e.uap.needsSaving?"ui-btn-orange":"bg-gray-800 text-gray-500 pointer-events-none"),onClick:e.uap.revert,disabled:!e.uap.needsSaving,children:"Revert"}),(0,i.jsx)("button",{className:"flex-none h-full px-4 border-none text-sm leading-none ui-btn-gray",onClick:e.openSettings,children:"Settings"})]})]})]})},R=n(6929),A=n(8787),E=n(9808),I=n.n(E);function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(Object(n),!0).forEach((function(t){(0,s.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var F=function(e){var t=(0,R.H)(),n=t.rect,a=t.ref,r=(0,f.useRef)(null),s=(0,f.useRef)(),u=(0,f.useRef)(!0);return(0,f.useEffect)((function(){e.logCount<=1&&(u.current=!0),r.current&&s.current&&u.current&&!D(s.current)&&r.current.scrollToItem(e.logCount-1)}),[e.logCount]),(0,i.jsx)("div",{className:"w-full h-full font-mono text-xs leading-none text-white whitespace-pre bg-gray-700 select-text",ref:a,style:{opacity:e.show?1:0},children:n&&n.width&&n.height&&(0,i.jsx)(A.t7,{width:n.width,height:n.height,itemCount:e.logCount,itemSize:20,ref:r,innerRef:s,onScroll:function(){requestAnimationFrame((function(){s.current&&(u.current=D(s.current))}))},children:function(t){var n=t.index,a=t.style,r=e.logAsStaticArrayRef.current[n];return(0,i.jsx)("div",{style:P(P({},a),{},{lineHeight:"20px",color:G(r.code)}),className:"px-2 py-0 m-0 select-text",children:r.text},n)}})})};function D(e){var t=e.parentElement;return!t||t.scrollTop+5>=t.scrollHeight-t.offsetHeight}function G(e){switch(e){case m.xe.Out:return I().white;case m.xe.Err:return I().red[400];case m.xe.StatusUpdate:return I().blue[300];case m.xe.Waiting:return I().purple[300];default:return I().white}}function q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q(Object(n),!0).forEach((function(t){(0,s.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var M,U=(0,v.default)((function(){return Promise.all([n.e(774),n.e(281),n.e(971),n.e(595)]).then(n.bind(n,7595))}),{loading:function(){return(0,i.jsx)("div",{className:"ui-pad",children:"Loading code editor..."})},ssr:!1,loadableGenerated:{webpack:function(){return[7595]},modules:["analysis.tsx -> ../components/analysis_code_editor"]}});!function(e){e[e.Inputs=0]="Inputs",e[e.Outputs=1]="Outputs",e[e.Log=2]="Log"}(M||(M={}));var B=function(e){(0,f.useEffect)((function(){return function(){a.current=!1,D()}}),[]);var t=(0,f.useRef)(void 0),n=(0,f.useRef)([{text:"Not yet run",code:m.xe.StatusUpdate}]),a=(0,f.useRef)(!1),s=(0,f.useState)(1),d=s[0],p=s[1];function v(){window.setTimeout((function(){p(n.current.length),a.current&&v()}),500)}var b=g(e.ua.refreshAnalyses),j=(0,f.useState)((0,x.Q3)()),N=j[0],w=j[1],C=(0,f.useState)(M.Inputs),k=C[0],R=C[1],A=(0,f.useState)(!1),E=A[0],I=A[1],z=e.uu.loginState===o.z.LoggedIn&&e.uu.user.canEdit;function P(){return(P=(0,u.Z)(r().mark((function e(t,n,a,i,s){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b.updateTempName(t),b.updateTempLanguage(n),b.updateTempTopic(a),b.updateTempTags(i),b.updateTempScheduled(s);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(){t.current&&t.current.readyState!==t.current.CLOSED&&(n.current.push({text:"*** Stopped by user ***",code:m.xe.StatusUpdate}),a.current=!1,w((function(e){var t=_({},e);return t.analyzing=!1,t.finalStatus=m.qb.StoppedByUser,t})),t.current.close(),e.ua.refreshAnalyses())}return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(l.default,{children:[(0,i.jsx)("title",{children:"Analysis Portal"}),(0,i.jsx)("link",{rel:"stylesheet",type:"text/css",href:"/roboto.css"})]}),(0,i.jsx)(h.i,{uu:e.uu,children:(0,i.jsxs)("div",{className:"flex flex-col w-full h-full",children:[(0,i.jsx)("div",{className:"flex-none w-full",children:(0,i.jsx)(T,{uap:b,openSettings:function(){return I(!0)},canEdit:z})}),b.data.loading?(0,i.jsx)("div",{className:"px-4 py-3 text-gray-400",children:"Loading analysis..."}):b.data.ready?(0,i.jsxs)("div",{className:"flex flex-1 w-full h-0",children:[(0,i.jsx)("div",{className:"h-full",style:{width:"60%"},children:(0,i.jsx)(U,{value:b.tempCode,onChange:b.updateTempCode,canEdit:z,isStata:b.tempLanguage===m.$v.Stata})}),(0,i.jsxs)("div",{className:"flex flex-col flex-1 w-0 h-full border-l-2 border-gray-800",children:[(0,i.jsx)("div",{className:"flex-none w-full border-b-2 border-gray-800",children:(0,i.jsx)(S,{uap:b,analysisStatus:N,analyze:function(){if(b.data.ready){var r=(0,x.Q3)();r.analyzing=!0,r[m.Hf.InitializeAnalysis]=m.Aq.Pending,r.finalStatus=m.qb.Running,a.current=!0,w(r),n.current=[{text:"*** Queued analysis ***",code:m.xe.StatusUpdate}],p(1),R(M.Log),v(),t.current=new EventSource("".concat(c.i,"/run/").concat(b.data.analysisPackage.id),{withCredentials:!0}),t.current.onmessage=function(r){var i=JSON.parse(r.data);switch(i.msgType){case m.Cs.Heartbeat:return;case m.Cs.Stage:return w((function(e){var t=_({},e);return t[i.stage]=i.stageResult,t})),i.stage===m.Hf.InitializeAnalysis&&i.stageResult===m.Aq.Failure&&n.current.push({text:"*** Could not start analysis ***",code:m.xe.StatusUpdate}),i.stage===m.Hf.ImportInputFiles&&i.stageResult===m.Aq.Failure&&n.current.push({text:"*** Could not find all input files ***",code:m.xe.StatusUpdate}),i.stage===m.Hf.CleanRun&&i.stageResult===m.Aq.Failure&&n.current.push({text:"*** Could not finish script ***",code:m.xe.StatusUpdate}),i.stage===m.Hf.OutputFiles&&i.stageResult===m.Aq.Failure&&n.current.push({text:"*** Could not find all output files ***",code:m.xe.StatusUpdate}),i.stage===m.Hf.ImportInputFiles&&i.stageResult===m.Aq.Success&&n.current.push({text:"*** Started script ***",code:m.xe.StatusUpdate}),void(i.stage===m.Hf.CleanRun&&i.stageResult===m.Aq.Success&&n.current.push({text:"*** Finished script ***",code:m.xe.StatusUpdate}));case m.Cs.Waiting:return void n.current.push({text:i.log,code:m.xe.Waiting});case m.Cs.LogOut:return void n.current.push({text:i.log,code:m.xe.Out});case m.Cs.LogErr:return void n.current.push({text:i.log,code:m.xe.Err});case m.Cs.EndFailure:return void(t.current&&t.current.readyState!==t.current.CLOSED&&(n.current.push({text:"*** Closed analysis: FAILED ***",code:m.xe.StatusUpdate}),a.current=!1,w((function(e){var t=_({},e);return t.finalStatus=m.qb.Failed,t.analyzing=!1,t})),t.current.close(),e.ua.refreshAnalyses()));case m.Cs.EndSuccess:return void(t.current&&t.current.readyState!==t.current.CLOSED&&(n.current.push({text:"*** Closed analysis: SUCCESS ***",code:m.xe.StatusUpdate}),a.current=!1,w((function(e){var t=_({},e);return t.finalStatus=m.qb.Success,t.analyzing=!1,t})),R(M.Outputs),t.current.close(),e.ua.refreshAnalyses()))}},t.current.onopen=function(e){},t.current.onerror=function(r){console.log("Error",r),t.current&&t.current.readyState!==t.current.CLOSED&&(n.current.push({text:"*** Closed analysis prematurely because of connection error ***",code:m.xe.StatusUpdate}),a.current=!1,w((function(e){var t=_({},e);return t.analyzing=!1,t})),t.current.close(),e.ua.refreshAnalyses())}}},stop:D})}),(0,i.jsxs)("div",{className:"flex items-center flex-none w-full h-10 text-white bg-gray-200 select-none font-book",children:[(0,i.jsx)("button",{className:"flex-none h-full px-4 border-none text-sm leading-none ".concat(k===M.Inputs?"bg-gray-800":"ui-btn-blue"),onClick:function(){return R(M.Inputs)},children:"Inputs"}),(0,i.jsx)("button",{className:"flex-none h-full px-4 border-none text-sm leading-none ".concat(k===M.Outputs?"bg-gray-800":"ui-btn-blue"),onClick:function(){return R(M.Outputs)},children:"Outputs"}),(0,i.jsx)("button",{className:"flex-none h-full px-4 border-none text-sm leading-none ".concat(k===M.Log?"bg-gray-800":"ui-btn-blue"),onClick:function(){return R(M.Log)},children:"Log"})]}),(0,i.jsxs)("div",{className:"flex-1 w-full h-0",children:[k===M.Inputs&&(0,i.jsx)(O,{uap:b,ua:e.ua,ud:e.ud,analysisId:b.data.analysisPackage.id,canEdit:z}),k===M.Outputs&&(0,i.jsx)(L,{uap:b,isAnalyzing:N.analyzing,canEdit:z}),(0,i.jsx)(F,{show:k===M.Log,logCount:d,logAsStaticArrayRef:n})]})]})]}):(0,i.jsx)("div",{className:"px-4 py-3 text-red-500",children:b.data.err}),E&&(0,i.jsx)(y.c,{initialName:b.tempName,initialLanguage:b.tempLanguage,initialTopic:b.tempTopic,initialTags:b.tempTags,initialScheduled:b.tempScheduled,save:function(e,t,n,a,r){return P.apply(this,arguments)},cancel:function(){return I(!1)},topics:e.ut.topics,isNewAnalysis:!1,attemptDeleteAnalysis:b.attemptDeleteAnalysis})]})})]})}},926:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/analysis",function(){return n(894)}])}},function(e){e.O(0,[774,231,724,888,179],(function(){return t=926,e(e.s=t);var t}));var t=e.O();_N_E=t}]);