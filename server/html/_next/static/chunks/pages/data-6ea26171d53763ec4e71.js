(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[81],{6585:function(e,t,n){"use strict";n.d(t,{P:function(){return p},K:function(){return f}});var i=n(5893),a=n(7294),s=n(938),r=n(9248),l=n(809),c=n.n(l),o=n(2447),u=n(6131);function d(e,t,n,i){var s=(0,a.useState)(void 0),r=s[0],l=s[1];function d(){return(d=(0,o.Z)(c().mark((function e(t,n,i){var a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l(void 0),e.next=3,(0,u.Oo)(t,n,i);case 3:if(a=e.sent){e.next=8;break}return console.error("Could not check file"),l({exists:!1,date:"",size:0,public:!1}),e.abrupt("return");case 8:l(a);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return(0,a.useEffect)((function(){i||function(e,t,n){d.apply(this,arguments)}(e,t,n||"noname")}),[e,t,n,i]),r}var f=function(e){var t=d(e.folderType,e.analysisId,e.fileName,e.needsSaving),n=(0,a.useState)(!1),l=n[0],c=n[1],o=(0,a.useRef)(null);var u=t&&t.exists?t.public?"".concat(r.i,"/exf/").concat(e.analysisId,"/").concat(e.fileName):"".concat(r.i,"/pvf/").concat(e.folderType,"/").concat(e.analysisId,"/").concat(e.fileName):"";return e.needsSaving?(0,i.jsx)("div",{className:"text-sm text-gray-500",children:"Save to confirm status"}):t?t.exists?t.public?(0,i.jsxs)("div",{className:"text-sm",children:[(0,i.jsx)("a",{ref:o,className:"break-all ui-link",href:u,download:!0,target:"_blank",children:"https://portal.comsa.org.mz"+u}),(0,i.jsxs)("div",{className:"mt-1",children:[(0,i.jsx)("span",{className:"px-2 py-1 text-xs ui-btn-lightgray",onClick:function(){o.current&&((0,s.Ms)(o.current),c(!0),setTimeout((function(){c(!1)}),1e3))},children:l?"Copied!":"Copy link"}),(0,i.jsxs)("span",{className:"ml-2",children:["Last modified: ",new Date(t.date).toLocaleString()]}),(0,i.jsxs)("span",{className:"ml-2",children:["Size: ",(0,s.gB)(t.size)]})]})]}):(0,i.jsxs)("div",{className:"text-sm",children:[(0,i.jsx)("a",{ref:o,className:"ui-link",href:u,download:!0,target:"_blank",children:"Download"}),(0,i.jsxs)("span",{className:"ml-2",children:["Last modified: ",new Date(t.date).toLocaleString()]}),(0,i.jsxs)("span",{className:"ml-2",children:["Size: ",(0,s.gB)(t.size)]})]}):(0,i.jsx)("div",{className:"text-sm text-red-500",children:"Does not exist"}):(0,i.jsx)("div",{className:"text-sm text-gray-500",children:"Checking file..."})},p=function(e){var t=e.url,n=e.linkLabel;return(0,i.jsx)("a",{className:"ui-link",href:t,download:!0,target:"_blank",children:n})}},5622:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return _}});var i,a=n(809),s=n.n(a),r=n(5893),l=n(1385),c=n(2447),o=n(9008),u=n(6131),d=n(8813),f=n(6585),p=n(938),x=n(5876),h=n(9248),m=n(7294),g=n(3384),j=n(8212),F=n(9429),v=n.n(F),N=n(6116),y=n.n(N),k=n(1705),D=(n(6271),n(1629),n(6028),n(1916),v()({allowMultipleUploads:!0,autoProceed:!0}));D.use(y(),{endpoint:"".concat(h.i,"/upload"),withCredentials:!0,formData:!0,fieldName:"actualfiledata"}),function(e){e[e.WaitingForDrop=0]="WaitingForDrop",e[e.Uploading=1]="Uploading",e[e.Complete=2]="Complete",e[e.RefreshingFiles=3]="RefreshingFiles"}(i||(i={}));var b=function(e){var t=(0,m.useState)(i.WaitingForDrop),n=t[0],a=t[1];function l(){return o.apply(this,arguments)}function o(){return(o=(0,c.Z)(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a(i.RefreshingFiles),t.next=3,e.refreshDataFiles();case 3:e.cancel(),D.reset();case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return(0,m.useEffect)((function(){D.on("upload",(function(e){a(i.Uploading)})),D.on("progress",(function(e){})),D.on("complete",(function(e){a(i.Complete)}))}),[]),(0,r.jsxs)(j.u_,{cancel:l,minWidth:600,children:[n===i.WaitingForDrop&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(k.v0,{uppy:D}),(0,r.jsx)(j.nK,{children:(0,r.jsx)(g.y3,{label:"Cancel",onClick:l})})]}),n===i.Uploading&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(k.A_,{uppy:D,hideUploadButton:!0,hideAfterFinish:!1,showProgressDetails:!0}),(0,r.jsx)(j.nK,{children:(0,r.jsx)(g.y3,{label:"Cancel upload",onClick:function(){D.reset(),a(i.WaitingForDrop)}})})]}),n===i.Complete&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(k.A_,{uppy:D,hideUploadButton:!0,hideAfterFinish:!1,showProgressDetails:!0}),(0,r.jsxs)(j.nK,{children:[(0,r.jsx)(g.y3,{label:"Done",onClick:l,color:g.Wo.Blue}),(0,r.jsx)(g.y3,{label:"Upload more files",onClick:function(){D.reset(),a(i.WaitingForDrop)},marginLeft:!0})]})]}),n===i.RefreshingFiles&&(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("div",{className:"",children:"Updating files..."})})]})},w=n(8080),C=n(6049),T=n(622),S=n(1203),L=function(e){return(0,r.jsxs)("div",{className:"px-4 py-4 text-sm",children:[e.nFiltered===e.nTotal?(0,r.jsxs)("div",{className:"",children:["Showing all ",e.nTotal," data files"]}):(0,r.jsxs)("div",{className:"font-bold text-purple-600",children:["Showing ",e.nFiltered," of ",e.nTotal," data files"]}),(0,r.jsx)("div",{className:"mt-4 font-bold",children:"Search"}),(0,r.jsxs)("div",{className:"flex items-center mt-1",children:[(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)(g.u3,{value:e.uui.searchTextData,onChange:function(t){return e.uui.updateSearchTextData(t)},purple:!0})}),""!==e.uui.searchTextData&&(0,r.jsx)("span",{className:"flex-none ml-2",children:(0,r.jsx)(g._3,{icon:C.b0D,onClick:e.uui.clearSearchTextData,color:g.Wo.Purple})})]}),(0,r.jsx)("div",{className:"mt-4 font-bold",children:"File types"}),(0,r.jsx)(S.z,{label:"ODK (pulled daily)",onClick:function(){return e.uui.toggleFileType("odk")},checked:"odk"===e.uui.selectedFileType}),(0,r.jsx)(S.z,{label:"Static",onClick:function(){return e.uui.toggleFileType("static")},checked:"static"===e.uui.selectedFileType})]})},P=n(8486),_=function(e){var t=(0,m.useState)(!1),n=t[0],i=t[1];function a(){return(a=(0,c.Z)(s().mark((function t(n){var i;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(window.confirm("Are you sure?")){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,(0,u.HO)(n);case 4:if(i=t.sent){t.next=9;break}return alert("Could not delete"),e.ud.refreshDataFiles(),t.abrupt("return");case 9:e.ud.updateDataFiles(i);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var j=e.uu.loginState===w.z.LoggedIn&&e.uu.user.canEdit,F=(0,m.useMemo)((function(){return e.ud.dataFiles.filter((function(t){return""===e.uui.searchTextData.trim()||t.fileName.toLowerCase().includes(e.uui.searchTextData.trim().toLowerCase())})).filter((function(t){return""===e.uui.selectedFileType||"odk"===e.uui.selectedFileType&&t.isODKFile||"static"===e.uui.selectedFileType&&!t.isODKFile}))}),[e.ud.dataFiles,e.uui.searchTextData,e.uui.selectedFileType]),v=(0,m.useMemo)((function(){var t=(0,l.Z)(F);switch(e.uui.filterPropertyData){case P.F7.Name:t.sort((function(e,t){return e.fileName.toLowerCase()>t.fileName.toLowerCase()?1:-1}));break;case P.F7.FileType:t.sort((function(e,t){return e.isODKFile?-1:1}));break;case P.F7.LastModified:t.sort((function(e,t){return e.date<t.date?1:-1}));break;case P.F7.Size:t.sort((function(e,t){return t.size-e.size}))}return t}),[F,e.uui.filterPropertyData]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(o.default,{children:[(0,r.jsx)("title",{children:"Analysis Portal"}),(0,r.jsx)("link",{rel:"stylesheet",type:"text/css",href:"/roboto.css"})]}),(0,r.jsxs)(x.L,{uu:e.uu,page:"data",title:"Data",buttons:j?[{label:"Refresh file listing",onClick:e.ud.refreshDataFiles,icon:C.DuK,color:g.Wo.LightGray},{label:"Upload file",onClick:function(){return i(!0)},icon:C.rG2}]:[{label:"Refresh file listing",onClick:e.ud.refreshDataFiles,icon:C.DuK,color:g.Wo.LightGray}],children:[e.ud.loading?(0,r.jsx)("div",{className:"",children:"Loading..."}):(0,r.jsx)(T.V,{filterControls:(0,r.jsx)(L,{uui:e.uui,nTotal:e.ud.dataFiles.length,nFiltered:v.length}),children:0===v.length?(0,r.jsx)("div",{className:"py-2 text-sm leading-5 text-gray-400",children:"No matching data files"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("li",{className:"grid grid-cols-12 gap-2 py-2 text-sm font-bold leading-5",children:[(0,r.jsxs)("div",{className:"".concat(j?"col-span-6":"col-span-7","  truncate cursor-pointer hover:underline"),onClick:function(){return e.uui.updateFilterPropertyData(P.F7.Name)},children:["File name",e.uui.filterPropertyData===P.F7.Name&&(0,r.jsx)(C.veu,{className:"inline-block w-3 h-3 ml-1"})]}),(0,r.jsxs)("div",{className:"flex items-center col-span-1 truncate cursor-pointer hover:underline",onClick:function(){return e.uui.updateFilterPropertyData(P.F7.FileType)},children:[(0,r.jsx)("span",{className:"flex-shrink inline-block truncate ",children:"File type"}),e.uui.filterPropertyData===P.F7.FileType&&(0,r.jsx)(C.veu,{className:"inline-block w-3 h-3 ml-1"})]}),(0,r.jsxs)("div",{className:"col-span-3 truncate cursor-pointer hover:underline",onClick:function(){return e.uui.updateFilterPropertyData(P.F7.LastModified)},children:["Last modified",e.uui.filterPropertyData===P.F7.LastModified&&(0,r.jsx)(C.veu,{className:"inline-block w-3 h-3 ml-1"})]}),(0,r.jsxs)("div",{className:"col-span-1 truncate cursor-pointer hover:underline",onClick:function(){return e.uui.updateFilterPropertyData(P.F7.Size)},children:["Size",e.uui.filterPropertyData===P.F7.Size&&(0,r.jsx)(C.veu,{className:"inline-block w-3 h-3 ml-1"})]})]}),v.map((function(e,t){var n="".concat(h.i,"/pvf/").concat(d.Sr.DATA,"/x/").concat(e.fileName);return(0,r.jsxs)("li",{className:"grid grid-cols-12 gap-2 py-2 text-sm leading-5 border-t border-gray-200 select-text",children:[(0,r.jsx)("div",{className:"".concat(j?"col-span-6":"col-span-7"," break-all leading-4"),children:(0,r.jsx)(f.P,{url:n,linkLabel:e.fileName})}),(0,r.jsx)("div",{className:"col-span-1 text-xs truncate",children:e.isODKFile?"ODK":"Static"}),(0,r.jsx)("div",{className:"col-span-3 text-xs truncate",children:new Date(e.date).toLocaleString()}),(0,r.jsx)("div",{className:"col-span-1 text-xs truncate",children:(0,p.gB)(e.size)}),j&&(0,r.jsx)("div",{className:"col-span-1 text-xs text-right truncate",children:(0,r.jsx)("span",{className:"text-xs ui-link-gray",onClick:function(){return function(e){return a.apply(this,arguments)}(e.fileName)},children:"Delete"})})]},t)}))]})}),n&&(0,r.jsx)(b,{cancel:function(){return i(!1)},refreshDataFiles:e.ud.refreshDataFiles})]})]})}},8602:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/data",function(){return n(5622)}])}},function(e){e.O(0,[774,231,935,695,888,179],(function(){return t=8602,e(e.s=t);var t}));var t=e.O();_N_E=t}]);